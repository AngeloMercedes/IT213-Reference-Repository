<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SJC MainteBot (Mobile)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
  :root{
    --brand:#004aad;
    --brand-2:#2563eb;
    --bg-grad-1:#4facfe;
    --bg-grad-2:#00f2fe;
    --card:rgba(255,255,255,0.95);
    --text:#0f172a;
    --muted:#6b7280;
    --bot:#e5e5ea;
    --user:#004aad;
  }

  *{box-sizing:border-box;margin:0;padding:0}

  body{
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(135deg,var(--bg-grad-1),var(--bg-grad-2));
    min-height:100vh; display:flex; align-items:center; justify-content:center;
  }

  /* Hide on desktop/tablet */
  @media (min-width:768px){
    body::before{
      content:"üì± This chatbot is available only on mobile devices.";
      font-size:18px; color:#fff; text-align:center; padding:20px;
      line-height:1.5;
    }
    .chat-container,.launcher{display:none!important}
  }

  /* Chat container */
  .chat-container{
    width:100%; max-width:420px; height:100vh;
    background:var(--card); backdrop-filter:blur(10px);
    display:flex; flex-direction:column;
    box-shadow:0 10px 40px rgba(0,0,0,0.2);
    animation:fadeIn .4s ease;
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

  .chat-header{
    background:linear-gradient(135deg,var(--brand),var(--brand-2));
    color:#fff; padding:12px 16px; display:flex; align-items:center; justify-content:space-between;
  }
  .chat-title{display:flex;align-items:center;gap:8px;font-weight:700}
  .chat-title .logo{
    width:26px;height:26px;border-radius:50%;background:#fff;color:var(--brand);
    display:grid;place-items:center;font-weight:800;
  }
  .header-actions button{
    border:none;background:transparent;color:#fff;font-size:16px;cursor:pointer;opacity:.9;
  }

  .chat-box{
    flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:10px;
    background:linear-gradient(180deg,#f8fafc,#eef2ff 30%, #f9fafb);
  }

  .day-divider{
    align-self:center;font-size:12px;color:var(--muted);
    background:#fff;border:1px solid #e5e7eb;padding:3px 10px;border-radius:999px;
    margin:4px 0 8px;
  }

  .message{
    max-width:80%; padding:10px 12px; border-radius:16px; font-size:14px; line-height:1.45;
    display:flex; gap:8px; word-wrap:break-word; white-space:pre-wrap;
    animation:pop .2s ease; box-shadow:0 2px 8px rgba(0,0,0,.06);
  }
  @keyframes pop{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

  .bot-message{align-self:flex-start;background:var(--bot);color:#000;border-bottom-left-radius:6px;}
  .user-message{align-self:flex-end;background:var(--user);color:#fff;border-bottom-right-radius:6px;}

  .avatar{width:24px;height:24px;border-radius:50%;overflow:hidden}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .bubble{display:flex;flex-direction:column;gap:6px}
  .meta{font-size:11px;opacity:.8}

  .typing{display:flex;gap:5px;align-items:center}
  .dot{width:6px;height:6px;background:#737373;border-radius:50%;animation:blink 1s infinite ease-in-out;}
  .dot:nth-child(2){animation-delay:.15s}
  .dot:nth-child(3){animation-delay:.3s}
  @keyframes blink{0%,80%,100%{opacity:.3}40%{opacity:1}}

  .quick-replies{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
  .chip{
    background:#111827;color:#fff;opacity:.9;border:none;border-radius:999px;
    padding:6px 10px;font-size:12px;cursor:pointer;
  }

  .chat-input{
    display:flex;gap:8px;border-top:1px solid #e5e7eb;padding:10px;background:#fff;
  }
  .chat-input input{
    flex:1;padding:10px 12px;border:1px solid #d1d5db;border-radius:999px;font-size:14px;
  }
  .send{
    width:40px;height:40px;border-radius:50%;border:none;
    background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;font-size:18px;cursor:pointer;
  }

  /* Report form */
  .report-card{
    background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:8px;
  }
  .row{display:flex;flex-wrap:wrap;gap:8px}
  .row>*{flex:1 1 100%}
  input[type="text"],textarea,select{
    width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;
  }
  textarea{min-height:80px;resize:vertical}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:8px;padding:10px;cursor:pointer;font-weight:600}
  .btn.secondary{background:#111827}
</style>
</head>
<body>

<div class="chat-container" id="chat">
  <div class="chat-header">
    <div class="chat-title">
      <div class="logo">SJ</div>
      <div>SJC MainteBot</div>
    </div>
    <div class="header-actions">
      <button onclick="toggleDark()">üåô</button>
    </div>
  </div>

  <div class="chat-box" id="chatBox">
    <div class="day-divider" id="todayLabel"></div>

    <div class="message bot-message">
      <div class="avatar"><img src="https://i.imgur.com/7k12EPD.png" alt="bot"></div>
      <div class="bubble">
        <div>üëã Hello! I‚Äôm your maintenance assistant. Ask about office hours, location, or <b>report an issue</b>.</div>
        <div class="quick-replies">
          <button class="chip" onclick="quick('Where is the maintenance office?')">üìç Office</button>
          <button class="chip" onclick="quick('What are the office hours?')">üïí Hours</button>
          <button class="chip" onclick="quick('Report a broken light')">üìù Report issue</button>
        </div>
        <div class="meta" id="greetTime"></div>
      </div>
    </div>
  </div>

  <div class="chat-input">
    <input id="userInput" type="text" placeholder="Type your message‚Ä¶"/>
    <button class="send" onclick="sendMessage()">‚û§</button>
  </div>
</div>

<script>
  const chatBox=document.getElementById('chatBox');
  const userInput=document.getElementById('userInput');
  const todayLabel=document.getElementById('todayLabel');
  const greetTime=document.getElementById('greetTime');

  function timestamp(){
    const d=new Date();
    return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  }
  function setDayDivider(){
    const d=new Date();
    todayLabel.textContent=d.toLocaleDateString(undefined,{weekday:'long',month:'short',day:'numeric'});
  }
  setDayDivider();
  greetTime.textContent=`Now ‚Ä¢ ${timestamp()}`;

  function scrollToBottom(){chatBox.scrollTop=chatBox.scrollHeight;}
  function addTyping(){
    const el=document.createElement('div');
    el.className='message bot-message';
    el.id='typing';
    el.innerHTML=`<div class="avatar"><img src="https://i.imgur.com/7k12EPD.png" alt="bot"></div>
      <div class="bubble typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
    chatBox.appendChild(el);scrollToBottom();
  }
  function removeTyping(){const t=document.getElementById('typing');if(t)t.remove();}
  function toggleDark(){document.documentElement.classList.toggle('dark');}

  function userBubble(text){
    const el=document.createElement('div');
    el.className='message user-message';
    el.innerHTML=`<div class="bubble">${escapeHtml(text)}<div class="meta">${timestamp()}</div></div>`;
    chatBox.appendChild(el);
  }
  function botBubble(html){
    const el=document.createElement('div');
    el.className='message bot-message';
    el.innerHTML=`<div class="avatar"><img src="https://i.imgur.com/7k12EPD.png" alt="bot"></div>
      <div class="bubble">${html}<div class="meta">${timestamp()}</div></div>`;
    chatBox.appendChild(el);
  }

  function quick(text){userInput.value=text;sendMessage();}
  function sendMessage(){
    const msg=userInput.value.trim();if(!msg)return;
    userBubble(msg);userInput.value='';addTyping();
    $.post('chatbot.php',{message:msg},function(res){
      removeTyping();
      if(!res||!res.type){botBubble('‚ö†Ô∏è Unexpected response from server.');return;}
      if(res.type==='report_form'){botBubble(renderReportForm());}
      else{botBubble(escapeHtml(res.reply||'...'));}
      scrollToBottom();
    },'json').fail(function(){removeTyping();botBubble('‚ö†Ô∏è Server error.');scrollToBottom();});
  }

  userInput.addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.preventDefault();sendMessage();}});
  function escapeHtml(s=''){return s.replace(/[&<>"'`=\/]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[c]));}
</script>
</body>
</html>
